<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            900: '#312e81',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            /* Subtle modern mesh gradient for light theme */
            background-image: radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.08) 0px, transparent 50%), radial-gradient(at 100% 0%, rgba(168, 85, 247, 0.08) 0px, transparent 50%);
            background-attachment: fixed;
        }
        /* Modern Card Style */
        
        .pro-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #4f46e5 0%, #9333ea 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* Loading Spinner */
        
        .custom-loader {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            position: relative;
            animation: rotate 1s linear infinite;
        }
        
        .custom-loader::before {
            content: "";
            box-sizing: border-box;
            position: absolute;
            inset: 0px;
            border-radius: 50%;
            border: 5px solid #e2e8f0;
            border-top-color: #4f46e5;
            animation: prixClipFix 2s linear infinite;
        }
        
        @keyframes rotate {
            100% {
                transform: rotate(360deg)
            }
        }
        
        @keyframes prixClipFix {
            0% {
                clip-path: polygon(50% 50%, 0 0, 0 0, 0 0, 0 0, 0 0)
            }
            25% {
                clip-path: polygon(50% 50%, 0 0, 100% 0, 100% 0, 100% 0, 100% 0)
            }
            50% {
                clip-path: polygon(50% 50%, 0 0, 100% 0, 100% 100%, 100% 100%, 100% 100%)
            }
            75% {
                clip-path: polygon(50% 50%, 0 0, 100% 0, 100% 100%, 0 100%, 0 100%)
            }
            100% {
                clip-path: polygon(50% 50%, 0 0, 100% 0, 100% 100%, 0 100%, 0 0)
            }
        }
        /* Canvas Area - Checkered Background for Transparency */
        
        .checker-bg {
            background-color: #ffffff;
            background-image: linear-gradient(45deg, #f1f5f9 25%, transparent 25%), linear-gradient(-45deg, #f1f5f9 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f1f5f9 75%), linear-gradient(-45deg, transparent 75%, #f1f5f9 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        
        #canvasArea {
            min-height: 600px;
        }
        
        @media (min-width: 1024px) {
            #canvasArea {
                min-height: 700px;
            }
        }
        /* Custom Scrollbar */
        
         ::-webkit-scrollbar {
            width: 8px;
        }
        
         ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
         ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
         ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col selection:bg-brand-100 selection:text-brand-900">

    <!-- Header -->
    <header class="w-full bg-white/80 border-b border-slate-200 sticky top-0 z-50 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 h-16 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div>
                    <h1 class="text-xl font-bold tracking-tight text-slate-900">AI Image Generator</h1>
                </div>
            </div>
            <div class="hidden sm:flex items-center gap-4 text-xs font-medium text-slate-500">
                <div class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-50 border border-slate-200">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span> System Operational
                </div>
                <a href="#" class="hover:text-brand-600 transition-colors">Documentation</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 flex flex-col lg:flex-row gap-6 max-w-7xl">

        <!-- Left Column: Controls -->
        <div class="w-full lg:w-[400px] flex flex-col gap-5 shrink-0">

            <!-- Control Panel -->
            <div class="pro-panel p-6 rounded-2xl flex flex-col gap-6 shadow-xl shadow-slate-200/50">

                <div class="flex justify-between items-center border-b border-slate-100 pb-4">
                    <h2 class="text-lg font-bold text-slate-800">Configuration</h2>
                    <span class="text-xs font-medium px-2 py-1 bg-brand-50 text-brand-700 rounded-md border border-brand-100">v2.0 Pro</span>
                </div>

                <!-- Prompt Input -->
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <label class="text-xs font-bold uppercase tracking-wider text-slate-500">Prompt</label>
                        <button id="randomPromptBtn" class="text-xs text-brand-600 hover:text-brand-700 font-medium transition-colors flex items-center gap-1.5 px-2 py-1 rounded hover:bg-brand-50">
                            <i class="fa-solid fa-dice"></i> Surprise Me
                        </button>
                    </div>
                    <div class="relative group">
                        <textarea id="promptInput" rows="4" class="w-full bg-white border border-slate-200 rounded-xl p-4 text-slate-700 placeholder-slate-400 focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 transition-all resize-none outline-none text-sm leading-relaxed shadow-sm group-hover:border-slate-300"
                            placeholder="Describe your imagination in detail..."></textarea>

                        <!-- Enhance Button (Floating) -->
                        <button id="enhanceBtn" class="absolute bottom-3 right-3 bg-white text-brand-600 border border-brand-200 hover:border-brand-300 hover:bg-brand-50 px-3 py-1.5 rounded-lg text-xs font-semibold transition-all flex items-center gap-2 shadow-sm">
                            <i class="fa-solid fa-sparkles"></i> Enhance
                        </button>
                    </div>
                </div>

                <!-- Settings Grid -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-1.5">
                        <label class="text-xs font-bold uppercase tracking-wider text-slate-500">Style</label>
                        <div class="relative">
                            <select id="styleSelect" class="w-full bg-white border border-slate-200 rounded-lg py-2.5 pl-3 pr-8 text-sm text-slate-700 font-medium focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none appearance-none cursor-pointer hover:border-slate-300 transition-colors shadow-sm">
                                <option value="">No Filter</option>
                                <option value="photorealistic">Photorealistic</option>
                                <option value="anime">Anime / Manga</option>
                                <option value="digital art">Digital Art</option>
                                <option value="oil painting">Oil Painting</option>
                                <option value="cyberpunk">Cyberpunk</option>
                                <option value="3d render">3D Render</option>
                                <option value="watercolor">Watercolor</option>
                            </select>
                            <div class="absolute right-3 top-3 pointer-events-none text-slate-400">
                                <i class="fa-solid fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-1.5">
                        <label class="text-xs font-bold uppercase tracking-wider text-slate-500">Dimensions</label>
                        <div class="relative">
                            <select id="ratioSelect" class="w-full bg-white border border-slate-200 rounded-lg py-2.5 pl-3 pr-8 text-sm text-slate-700 font-medium focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 outline-none appearance-none cursor-pointer hover:border-slate-300 transition-colors shadow-sm">
                                <option value="1:1">Square (1:1)</option>
                                <option value="16:9">Landscape (16:9)</option>
                                <option value="9:16">Portrait (9:16)</option>
                            </select>
                            <div class="absolute right-3 top-3 pointer-events-none text-slate-400">
                                <i class="fa-solid fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Generate Button -->
                <button id="generateBtn" class="w-full mt-2 bg-slate-900 hover:bg-slate-800 text-white font-semibold py-4 px-6 rounded-xl shadow-lg shadow-slate-900/20 transform transition-all active:scale-[0.98] flex justify-center items-center gap-2 group">
                    <span class="group-hover:tracking-wide transition-all">Generate Image</span>
                    <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform text-brand-400"></i>
                </button>
            </div>

            <!-- Enhanced Prompt Display (Hidden initially) -->
            <div id="enhancedPromptBox" class="hidden bg-brand-50 border border-brand-100 p-4 rounded-xl">
                <div class="flex justify-between items-start mb-2">
                    <span class="text-[10px] font-bold text-brand-600 uppercase tracking-wider flex items-center gap-1">
                        <i class="fa-solid fa-magic"></i> AI Enhanced
                    </span>
                    <button id="copyPromptBtn" class="text-brand-400 hover:text-brand-700 transition-colors" title="Copy to clipboard">
                        <i class="fa-regular fa-copy"></i>
                    </button>
                </div>
                <p id="enhancedPromptText" class="text-sm text-brand-900 italic leading-relaxed"></p>
            </div>

            <!-- History -->
            <div class="pro-panel rounded-2xl flex-1 flex flex-col overflow-hidden min-h-[200px] shadow-lg shadow-slate-200/50">
                <div class="p-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                    <h3 class="text-xs font-bold uppercase tracking-wider text-slate-500">History</h3>
                    <span class="text-xs text-slate-400">Session Storage</span>
                </div>
                <div id="historyContainer" class="p-3 space-y-2 overflow-y-auto max-h-[300px]">
                    <div class="text-center text-slate-400 text-sm py-8 flex flex-col items-center gap-2">
                        <i class="fa-regular fa-clock text-2xl text-slate-300"></i>
                        <span>No recent generations</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Preview Stage -->
        <div class="w-full lg:flex-1">
            <div class="pro-panel p-3 rounded-2xl relative shadow-2xl shadow-slate-200/50 overflow-hidden flex flex-col h-full">

                <!-- Main Canvas -->
                <div id="canvasArea" class="checker-bg relative w-full rounded-xl overflow-hidden flex items-center justify-center border border-slate-200">

                    <!-- Empty State -->
                    <div id="emptyState" class="text-center p-8 max-w-md">
                        <div class="w-24 h-24 bg-white rounded-2xl mx-auto mb-6 flex items-center justify-center border border-slate-100 shadow-sm rotate-3 transform transition-transform hover:rotate-0">
                            <i class="fa-solid fa-image text-4xl text-slate-200"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-slate-800 mb-2">Ready to Create?</h2>
                        <p class="text-slate-500 text-base">Enter a prompt on the left to generate high-quality AI imagery.</p>
                    </div>

                    <!-- Loading State -->
                    <div id="loadingState" class="hidden absolute inset-0 bg-white/80 z-20 flex flex-col items-center justify-center backdrop-blur-sm">
                        <div class="custom-loader mb-6"></div>
                        <h3 class="text-lg font-bold text-slate-800 mb-1" id="loadingText">Processing...</h3>
                        <p class="text-slate-500 text-sm">Translating pixels to imagination</p>
                    </div>

                    <!-- Error State -->
                    <div id="errorState" class="hidden absolute inset-0 bg-white/95 z-20 flex flex-col items-center justify-center p-8 text-center">
                        <div class="w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mb-4">
                            <i class="fa-solid fa-triangle-exclamation text-red-500 text-xl"></i>
                        </div>
                        <h3 class="text-lg font-bold text-slate-900 mb-2">Generation Failed</h3>
                        <p id="errorMessage" class="text-slate-500 text-sm mb-6 max-w-xs">Something went wrong.</p>
                        <button onclick="document.getElementById('errorState').classList.add('hidden')" class="px-5 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm text-slate-700 font-medium transition-colors">Dismiss</button>
                    </div>

                    <!-- Result Image -->
                    <img id="resultImage" class="hidden w-full h-full object-contain shadow-sm transition-all duration-700" alt="Generated AI Art">
                </div>

                <!-- Action Bar (Appears when image exists) -->
                <div id="actionBar" class="hidden p-4 bg-white border-t border-slate-100 flex justify-between items-center">
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-green-500"></div>
                        <span class="text-xs font-medium text-slate-500">Generation Complete</span>
                    </div>
                    <div class="flex gap-3">
                        <button id="downloadBtn" class="bg-brand-600 hover:bg-brand-700 text-white px-5 py-2.5 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 shadow-lg shadow-brand-500/20">
                            <i class="fa-solid fa-download"></i> Download HD
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        // ============================================
        // BACKEND API CONFIGURATION
        // ============================================
        const API_BASE_URL = '/api';

        // --- State Management ---
        const state = {
            isGenerating: false,
            isEnhancing: false,
            currentImageBlob: null,
            history: []
        };

        // --- DOM Elements ---
        const els = {
            promptInput: document.getElementById('promptInput'),
            styleSelect: document.getElementById('styleSelect'),
            ratioSelect: document.getElementById('ratioSelect'),
            generateBtn: document.getElementById('generateBtn'),
            enhanceBtn: document.getElementById('enhanceBtn'),
            resultImage: document.getElementById('resultImage'),
            emptyState: document.getElementById('emptyState'),
            loadingState: document.getElementById('loadingState'),
            loadingText: document.getElementById('loadingText'),
            errorState: document.getElementById('errorState'),
            errorMessage: document.getElementById('errorMessage'),
            actionBar: document.getElementById('actionBar'),
            downloadBtn: document.getElementById('downloadBtn'),
            enhancedPromptBox: document.getElementById('enhancedPromptBox'),
            enhancedPromptText: document.getElementById('enhancedPromptText'),
            randomPromptBtn: document.getElementById('randomPromptBtn'),
            historyContainer: document.getElementById('historyContainer')
        };

        // --- Helper: Random Prompts ---
        const randomPrompts = [
            "A minimalistic modern office space with sunlight streaming through large windows",
            "A futuristic eco-friendly city integrated with nature, high detail",
            "Portrait of a professional woman in a suit, studio lighting, 8k",
            "Abstract geometric shapes with pastel colors, 3d render",
            "A calm zen garden with cherry blossoms, watercolor style"
        ];

        // ============================================
        // BACKEND API FUNCTIONS
        // ============================================

        async function callTextAPI(prompt) {
            try {
                // NOTE: Ensure your backend handles this endpoint
                const response = await fetch(`${API_BASE_URL}/enhance-prompt`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt
                    })
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'Failed to enhance prompt');
                }

                return data.enhanced_prompt;
            } catch (error) {
                console.error("Enhance API Error:", error);
                throw error;
            }
        }

        async function callImageAPI(prompt, style = '') {
            try {
                // NOTE: Ensure your backend handles this endpoint
                const response = await fetch(`${API_BASE_URL}/generate-image`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt,
                        style
                    })
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'Failed to generate image');
                }

                return data.image;
            } catch (error) {
                console.error("Image API Error:", error);
                throw error;
            }
        }

        // ============================================
        // CORE LOGIC
        // ============================================

        async function enhancePrompt() {
            if (state.isEnhancing) return;

            const originalText = els.promptInput.value.trim();
            if (!originalText) {
                showNotification("Please enter a prompt first!", "error");
                return;
            }

            state.isEnhancing = true;
            els.enhanceBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';
            els.enhanceBtn.disabled = true;

            try {
                const enhancedText = await callTextAPI(originalText);

                els.promptInput.value = enhancedText.trim();
                els.enhancedPromptBox.classList.remove('hidden');
                els.enhancedPromptText.textContent = enhancedText.trim();
                console.log("âœ… Prompt enhanced successfully!");

            } catch (error) {
                const errorMsg = error.message || "Could not enhance prompt";
                // Only log error, don't break UI for demo
                console.error("Enhance error:", errorMsg);
                // Fallback simulation for demo if API fails
                setTimeout(() => {
                    const simEnhanced = "Highly detailed, " + originalText + ", professional lighting, 8k resolution, photorealistic masterpiece.";
                    els.promptInput.value = simEnhanced;
                    els.enhancedPromptBox.classList.remove('hidden');
                    els.enhancedPromptText.textContent = simEnhanced;
                }, 1000);
            } finally {
                els.enhanceBtn.innerHTML = '<i class="fa-solid fa-sparkles"></i> Enhance';
                els.enhanceBtn.disabled = false;
                state.isEnhancing = false;
            }
        }

        async function handleGenerate() {
            if (state.isGenerating) return;

            const prompt = els.promptInput.value.trim();
            if (!prompt) {
                showNotification("Please describe what you want to see!", "error");
                return;
            }

            setLoading(true);

            try {
                const style = els.styleSelect.value;
                console.log("ðŸŽ¨ Starting image generation...");

                const base64Image = await callImageAPI(prompt, style);
                const imageUrl = `data:image/png;base64,${base64Image}`;

                console.log("âœ… Image generated successfully!");

                displayImage(imageUrl);
                addToHistory(imageUrl, prompt);

                state.currentImageBlob = base64Image;

            } catch (error) {
                const errorMsg = error.message || "Failed to generate image";
                console.error("Generation error:", errorMsg);
                showError("Connection error. Ensure backend is running.");
            } finally {
                setLoading(false);
            }
        }

        // ============================================
        // UI FUNCTIONS
        // ============================================

        function setLoading(isLoading) {
            state.isGenerating = isLoading;
            if (isLoading) {
                els.generateBtn.disabled = true;
                els.generateBtn.classList.add('opacity-75', 'cursor-not-allowed');
                els.generateBtn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Creating...';
                els.loadingState.classList.remove('hidden');
                els.errorState.classList.add('hidden');
                els.actionBar.classList.add('hidden');
            } else {
                els.generateBtn.disabled = false;
                els.generateBtn.classList.remove('opacity-75', 'cursor-not-allowed');
                els.generateBtn.innerHTML = '<span class="group-hover:tracking-wide transition-all">Generate Image</span><i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform text-brand-400"></i>';
                els.loadingState.classList.add('hidden');
            }
        }

        function displayImage(src) {
            els.resultImage.src = src;
            els.resultImage.onload = () => {
                els.emptyState.classList.add('hidden');
                els.resultImage.classList.remove('hidden');
                els.actionBar.classList.remove('hidden');
            };
        }

        function showError(msg) {
            els.errorState.classList.remove('hidden');
            els.errorMessage.textContent = msg;
            els.emptyState.classList.add('hidden');
        }

        function addToHistory(url, prompt) {
            // Remove "No recent" text if it exists
            const emptyMsg = els.historyContainer.querySelector('.text-center');
            if (emptyMsg) {
                emptyMsg.remove();
            }

            const div = document.createElement('div');
            div.className = "flex gap-3 p-2 rounded-lg hover:bg-slate-100 cursor-pointer transition-all group border border-transparent hover:border-slate-200";
            div.innerHTML = `
                <img src="${url}" class="w-12 h-12 rounded-md object-cover bg-slate-200 border border-slate-200 shadow-sm">
                <div class="flex-1 min-w-0 flex flex-col justify-center">
                    <p class="text-xs text-slate-700 truncate font-semibold group-hover:text-brand-600 transition-colors">${prompt}</p>
                    <p class="text-[10px] text-slate-400 flex items-center gap-1">
                        <i class="fa-solid fa-check text-green-500"></i> Completed
                    </p>
                </div>
            `;

            div.onclick = () => {
                els.promptInput.value = prompt;
                displayImage(url);
            };

            els.historyContainer.prepend(div);
            if (els.historyContainer.children.length > 10) {
                els.historyContainer.lastChild.remove();
            }
        }

        function showNotification(msg, type = 'info') {
            if (type === 'error') {
                console.error(msg);
                alert(msg); // Replace with a nicer toast in production
            } else {
                console.log(msg);
            }
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================

        els.generateBtn.addEventListener('click', handleGenerate);
        els.enhanceBtn.addEventListener('click', enhancePrompt);

        els.randomPromptBtn.addEventListener('click', () => {
            const randomPrompt = randomPrompts[Math.floor(Math.random() * randomPrompts.length)];
            els.promptInput.value = randomPrompt;
            // Visual feedback
            els.randomPromptBtn.innerHTML = '<i class="fa-solid fa-check"></i> Applied';
            setTimeout(() => {
                els.randomPromptBtn.innerHTML = '<i class="fa-solid fa-dice"></i> Surprise Me';
            }, 1000);
        });

        els.downloadBtn.addEventListener('click', () => {
            if (!els.resultImage.src) return;
            const link = document.createElement('a');
            link.href = els.resultImage.src;
            link.download = `dreamstream-pro-${Date.now()}.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        document.getElementById('copyPromptBtn').addEventListener('click', () => {
            navigator.clipboard.writeText(els.enhancedPromptText.textContent);
            const btn = document.getElementById('copyPromptBtn');
            const originalIcon = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-check"></i>';
            setTimeout(() => {
                btn.innerHTML = originalIcon;
            }, 1500);
        });

        els.promptInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (!state.isGenerating) {
                    handleGenerate();
                }
            }
        });

        console.log("âœ… DreamStream AI Pro Frontend Loaded");
    </script>
</body>

</html>